<html><title>F2B timer</title><script>var refreshInterval = null;var startBtn, stopBtn, timerElement, throttleElement, speedSpan, rpmElement;var loadPresetValues = true;function init() {startBtn = document.getElementById('startBtn');stopBtn = document.getElementById('stopBtn');timerElement = document.getElementById('timerPreset');throttleElement = document.getElementById('throttlePreset');speedSpan = document.getElementById('speedSpan');rpmElement = document.getElementsByTagName('rpmElement');if (refreshInterval === null) {refreshInterval = setInterval(refresh, 1000);}}function getData(callback) {var httpRequest = new XMLHttpRequest();httpRequest.open('GET', '/get', true);httpRequest.send();httpRequest.onreadystatechange = () => {if (httpRequest.readyState === 4 && httpRequest.status === 200) {var json = JSON.parse(httpRequest.response);console.log(json);callback(json);}}}function savePresetsCommand(timer, throttle, callback) {var json = {preset: {timeSec: timer, speed: throttle, delaySec: 15, autostart: 0}};sendCommand('PUT', '/set', JSON.stringify(json), callback);}function sendStartCommand(callback) {sendCommand('GET', '/timer/start', undefined, callback);}function sendStopCommand(callback) {sendCommand('GET', '/timer/stop', undefined, callback);}function speedUp() {sendCommand('GET', '/speed/up', undefined, () => {});}function speedDown() {sendCommand('GET', '/speed/down', undefined, () => {});}function sendCommand(method, path, data, callback) {var httpRequest = new XMLHttpRequest();httpRequest.open(method, path, true);httpRequest.setRequestHeader('Content-Type', 'application/json');httpRequest.send(data);httpRequest.onreadystatechange = () => {if (httpRequest.readyState === 4 && httpRequest.status === 200) {callback();}}}function setPresetValues(preset) {if (loadPresetValues) {timerElement.value = preset.timeSec;throttleElement.value = preset.speed;loadPresetValues = false;}}function createTimerString(state) {var ellapsedMs = (state.finishAt - state.time);var timestamp = new Date(ellapsedMs);var minutes = timestamp.getMinutes();var seconds = timestamp.getSeconds();return minutes + ':' + seconds;}function setState(state) {if (state.finishAt > 0) {showStop();stopBtn.innerText = 'STOP (' + createTimerString(state) + ')';} else {showStart();}}function showStart() {startBtn.hidden = false;stopBtn.hidden = true;}function showStop() {startBtn.hidden = true;stopBtn.hidden = false;}function refresh() {getData((json) => {setPresetValues(json.preset);setState(json.current);speedSpan.innerText = json.current.speed.toString() + ' %';rpmElement.innerText = 'RPM: ' + json.current.rpm.toString();});}function startTimer() {showStop();sendStartCommand(() => {refreshInterval = setInterval(refresh, 1000);});console.log('start');}function stopTimer() {showStart();sendStopCommand(() => {refresh();});console.log('stop');}function savePresets() {var timer = timerElement.value;var throttle = throttleElement.value;savePresetsCommand(timer, throttle, () => {loadPresetValues = true;refresh();});}refresh();</script><body onload='init()'><h1>Stunt timer</h1><h2>Preset</h2><p><table><tr><td>Timer</td><td><input id='timerPreset' max=600000 min=1 type=number/></td><td>s</td></tr><tr><td>Throttle</td><td><input id='throttlePreset' max=100 min=0 type=number/></td><td>%</td></tr><tr><td><button id='savePresetBtn' onclick='savePresets()'>Save changes</button></td></tr></table></p><hr/><p><button hidden='true' id='startBtn' onclick='startTimer()'>START</button><button hidden='true' id='stopBtn'onclick='stopTimer()'>STOP ()</button><span id='speedSpan'>0 %</span><br><span id='rpmElement'>RPM: 0</span></p><p><button id='speedUpBtn' onclick='speedUp()'>Speed UP</button><button id='speedDownBtn' onclick='speedDown()'>Speed DOWN</button></p></body></html>
